{% extends "base.html" %}

{% block title %}{{ product.name }} - GetYourGps{% endblock %}

{% block content %}
<!-- Cart Success Toast Notification (hidden by default) -->
<div id="cartToast" class="toast position-fixed top-0 end-0 m-3" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="5000" style="z-index: 9999;">
  <div class="toast-header bg-success text-white">
    <i class="bi bi-check-circle-fill me-2"></i>
    <strong class="me-auto">Success!</strong>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
  </div>
  <div class="toast-body">
    <p id="toastMessage">"<span id="productNameToast"></span>" has been added to your cart.</p>
    <div class="mt-2 pt-2 border-top">
      <a href="{{ url_for('cart') }}" class="btn btn-success btn-sm">View Cart</a>
    </div>
  </div>
</div>

<div class="container py-5">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('index') }}" class="text-success">Home</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('shop') }}" class="text-success">Shop</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ product.name }}</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Product Images -->
        <div class="col-md-6">
            <div class="product-main-image mb-4">
                <img src="{{ product.images[0] }}" alt="{{ product.name }}" class="img-fluid rounded" id="mainImage">
            </div>
            <div class="product-thumbnails d-flex flex-wrap gap-2">
                {% for image in product.images %}
                <div class="thumbnail" style="width: 80px; height: 80px; cursor: pointer;">
                    <img src="{{ image }}" alt="Thumbnail {{ loop.index }}" class="img-fluid rounded" style="width: 100%; height: 100%; object-fit: cover;" onclick="changeImage(this.src)">
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Product Details -->
        <div class="col-md-6">
            <h1 class="mb-3">{{ product.name }}</h1>
            <p class="text-muted">{{ product.short_desc }}</p>
            
            <div class="d-flex align-items-center mb-3">
                <h3 class="text-success me-3">{{ product.price_range }}</h3>
                <span class="badge bg-success">Free Shipping</span>
            </div>
            
            <div class="mb-4">
                <div class="d-flex align-items-center mb-2">
                    <i class="bi bi-check-circle-fill text-success me-2"></i>
                    <span>Free Lifetime Map Updates</span>
                </div>
                <div class="d-flex align-items-center mb-2">
                    <i class="bi bi-check-circle-fill text-success me-2"></i>
                    <span>1-Year Warranty</span>
                </div>
                <div class="d-flex align-items-center mb-2">
                    <i class="bi bi-check-circle-fill text-success me-2"></i>
                    <span>30-Day Money Back Guarantee</span>
                </div>
            </div>
            
            <div class="d-grid gap-2 d-md-flex mb-4">
                <button class="btn btn-success btn-lg flex-fill" onclick="addToCart({{ product.id }})">
                    <i class="bi bi-cart-plus me-2"></i>Add to Cart
                </button>
                <button class="btn btn-outline-success btn-lg flex-fill">
                    <i class="bi bi-heart me-2"></i>Add to Wishlist
                </button>
            </div>
            
            <div class="card mb-4">
                <div class="card-header bg-light-green">
                    <h5 class="mb-0">Product Highlights</h5>
                </div>
                <div class="card-body">
                    <p>{{ product.description }}</p>
                    <ul class="list-unstyled">
                        <li><i class="bi bi-check text-success me-2"></i>7-inch HD touch screen display</li>
                        <li><i class="bi bi-check text-success me-2"></i>FM transmitter for audio through car speakers</li>
                        <li><i class="bi bi-check text-success me-2"></i>Preloaded with latest maps</li>
                        <li><i class="bi bi-check text-success me-2"></i>Multimedia playback support</li>
                        <li><i class="bi bi-check text-success me-2"></i>Voice-guided navigation</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Specifications -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-light-green">
                    <h3 class="mb-0">Specifications</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for key, value in product.specs.items() %}
                        <div class="col-md-6 mb-3">
                            <strong>{{ key }}:</strong> {{ value }}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Features Section -->
    <div class="row mt-5">
        <div class="col-12">
            <h2 class="text-center mb-4">Why Choose Our GPS Navigator?</h2>
            <div class="row">
                <div class="col-md-4 text-center mb-4">
                    <div class="bg-light-green rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="bi bi-geo-alt-fill text-success" style="font-size: 2rem;"></i>
                    </div>
                    <h5>Lifetime Map Updates</h5>
                    <p>Always have the latest roads, points of interest, and navigation data with free lifetime updates.</p>
                </div>
                <div class="col-md-4 text-center mb-4">
                    <div class="bg-light-green rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="bi bi-mic-fill text-success" style="font-size: 2rem;"></i>
                    </div>
                    <h5>Voice Guidance</h5>
                    <p>Clear voice instructions keep your eyes on the road while navigating to your destination.</p>
                </div>
                <div class="col-md-4 text-center mb-4">
                    <div class="bg-light-green rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="bi bi-music-note-beamed text-success" style="font-size: 2rem;"></i>
                    </div>
                    <h5>FM Transmitter</h5>
                    <p>Play navigation instructions and music through your car's speakers with built-in FM transmitter.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- FAQ Section -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-light-green">
                    <h3 class="mb-0">Frequently Asked Questions</h3>
                </div>
                <div class="card-body">
                    <div class="accordion" id="faqAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    How often are map updates released?
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    We release map updates quarterly to ensure you always have the latest road information, points of interest, and navigation data.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    Does this GPS work outside the country?
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Yes, our GPS devices come with preloaded maps for multiple regions. You can download additional maps for other countries through our update portal.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingThree">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                    What is the warranty period?
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    All our products come with a 1-year manufacturer warranty that covers defects and technical issues. We also offer a 30-day money-back guarantee.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Related Products -->
<div class="container mt-5">
    <div class="row">
        <div class="col-12 text-center mb-4">
            <h2 class="text-success fw-bold">You May Also Like</h2>
        </div>
    </div>
    <div class="row gx-4">
        {% for rp in related_products %}
        <div class="col-12 col-sm-6 col-md-3 mb-4">
            <div class="card h-100">
                <img src="{{ rp.images[0] }}" class="card-img-top" alt="{{ rp.name }}">
                <div class="card-body">
                    <h6 class="card-title">{{ rp.name }}</h6>
                    <p class="text-success fw-bold">{{ rp.price_range }}</p>
                    <a href="{{ url_for('product_detail', id=rp.id) }}" class="btn btn-outline-success btn-sm">View</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function changeImage(src) {
        document.getElementById('mainImage').src = src;
    }
    
    // Cart functionality
    function addToCart(productId) {
        // Get current cart from localStorage
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        // Check if product already exists in cart
        const existingItemIndex = cart.findIndex(item => item.id === productId);
        
        if (existingItemIndex !== -1) {
            // If product exists, increase quantity
            cart[existingItemIndex].quantity += 1;
        } else {
            // If product doesn't exist, add it to cart
            const productName = "{{ product.name }}";
            const productPrice = {{ product.price_min }};
            const productImage = "{{ product.images[0] }}";
            
            cart.push({
                id: productId,
                name: productName,
                price: productPrice,
                image: productImage,
                quantity: 1
            });
        }
        
        // Save updated cart to localStorage
        localStorage.setItem('cart', JSON.stringify(cart));
        
        // Update cart count in navbar
        updateCartCount();
        
        // Show success toast
        document.getElementById('productNameToast').textContent = "{{ product.name }}";
        const toast = new bootstrap.Toast(document.getElementById('cartToast'));
        toast.show();
    }
    
    function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
        
        // Update cart count in navbar
        const cartCountElements = document.querySelectorAll('.cart-count');
        cartCountElements.forEach(element => {
            element.textContent = totalItems;
        });
    }
    
    // Initialize cart count on page load
    document.addEventListener('DOMContentLoaded', function() {
        updateCartCount();
    });
</script>
{% endblock %}